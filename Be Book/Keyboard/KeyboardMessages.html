<HTML><HEAD><TITLE>Keyboard: The Journey of a Keystroke</TITLE></HEAD><BODY BGCOLOR=#ffffff>


<!--TOP LINKS-->
<HR>
<center>
<TABLE bgcolor=ddeeee>
<TR><TD>
<A HREF="index.html"><FONT face=HELVETICA>Keyboard Table of Contents</FONT></A>&nbsp;&nbsp;
<TD>
&nbsp;&nbsp;<A HREF="Keyboard%20Master%20Index.html"><FONT face=HELVETICA>Keyboard Index</FONT></A>
</TABLE></center>
<!--TOP LINKS-->


<HR>
<H1>
<A NAME="The%20Journey%20of%20a%20Keystroke"></A>The Journey of a Keystroke
</H1>
<P>
When the user presses a key, a series of events is launched to handle that action.  Let's follow the bits through the system after the user presses a key on the keyboard.
<P>
<HR>
<H2>
<A NAME="Step%201:%20The%20Input%20Server%20Add-on"></A><FONT SIZE=6>S</FONT>tep 1: <FONT SIZE=6>T</FONT>he <FONT SIZE=6>I</FONT>nput <FONT SIZE=6>S</FONT>erver <FONT SIZE=6>A</FONT>dd-on
</H2>
<P>
When the user presses a key on the keyboard, the entity responsible for recognizing this action is the Input Server add-on for the keyboard device on which the key was pressed.  The add-on uses the current keymap (which it has obtained by calling <B><TT><A HREF="../The%20Input%20Server/InputFunctions.html#get_key_map()">get_key_map()</A></TT></B>) to map the keycode to the character.
<P>
The add-on then constructs a <B><TT><A HREF="../Messages/GeneralMessages.html#B_KEY_DOWN">B_KEY_DOWN</A></TT></B> or <B><TT><A HREF="../Messages/GeneralMessages.html#B_UNMAPPED_KEY_DOWN">B_UNMAPPED_KEY_DOWN</A></TT></B> <A HREF="../Release%20Notes/AppKit.html#BMessage">BMessage</A>, containing both the raw keycode and the actual characters generated by the key, and sends the message to the Application Server by calling the <B><TT><A HREF="../The%20Input%20Server/InputServerDevice.html#EnqueueMessage()">BInputServerDevice::EnqueueMessage()</A></TT></B> function.
<P>
<HR>
<H2>
<A NAME="Step%202:%20The%20Application%20Server"></A><FONT SIZE=6>S</FONT>tep 2: <FONT SIZE=6>T</FONT>he <FONT SIZE=6>A</FONT>pplication <FONT SIZE=6>S</FONT>erver
</H2>
<P>
The Aplication Server receives the message from the Input Server add-on and decides what to do with it.  If the key pressed is something the Application Server traps, like a workspace change keystroke, it gets handled internally.
<P>
Otherwise, the Application server locates the active window and passes the <A HREF="../Release%20Notes/AppKit.html#BMessage">BMessage</A> along to its <B><TT><A HREF="../The%20Interface%20Kit/Window.html#DispatchMessage()">BWindow::DispatchMessage()</A></TT></B> function.
<P>
<HR>
<H2>
<A NAME="Step%203:%20The%20Active%20Window"></A><FONT SIZE=6>S</FONT>tep 3: <FONT SIZE=6>T</FONT>he <FONT SIZE=6>A</FONT>ctive <FONT SIZE=6>W</FONT>indow
</H2>
<P>
The <B><TT><A HREF="../The%20Interface%20Kit/Window.html#DispatchMessage()">BWindow::DispatchMessage()</A></TT></B> function receives the <A HREF="../Release%20Notes/AppKit.html#BMessage">BMessage</A> from the Application Server, and intercepts some keys (like menu shortcuts and the Command-W close window sequence).  If it's not a key the <A HREF="../The%20Interface%20Kit/Window.html#BWindow">BWindow</A> class (or derived class) wants to intercept, DispatchMessage passes the message along to the currently focused view's <B><TT>BView::MessageReceived()</TT></B> function.
<P>
<HR>
<H2>
<A NAME="Step%204:%20The%20Focused%20View"></A><FONT SIZE=6>S</FONT>tep 4: <FONT SIZE=6>T</FONT>he <FONT SIZE=6>F</FONT>ocused <FONT SIZE=6>V</FONT>iew
</H2>
<P>
The message finally arrives at the view that's currently focused in the active window.  This view's <B><TT><A HREF="../The%20Application%20Kit/Handler.html#MessageReceived()">MessageReceived()</A></TT></B> function processes the keypress in whatever way it wants to.
<P>
Likewise, when the key is released, a <B><TT><A HREF="../Messages/GeneralMessages.html#B_KEY_UP">B_KEY_UP</A></TT></B> or <B><TT><A HREF="../Messages/GeneralMessages.html#B_UNMAPPED_KEY_UP">B_UNMAPPED_KEY_UP</A></TT></B> event is sent through this same route.
<P>
</PRE></TABLE></UL></MENU></B></I></TT>



<!--TOP LINKS-->
<HR>
<center>
<TABLE bgcolor=ddeeee>
<TR><TD>
<A HREF="index.html"><FONT face=HELVETICA>Keyboard Table of Contents</FONT></A>&nbsp;&nbsp;
<TD>
&nbsp;&nbsp;<A HREF="Keyboard%20Master%20Index.html"><FONT face=HELVETICA>Keyboard Index</FONT></A>
</TABLE></center>
<!--TOP LINKS-->


<!-- Footer for Release 5 HTML Be Book -->
<hr>
<br>
<p>
<center>
<i><FONT size=6>T</FONT>he <FONT size=6 color=blue>B</FONT><FONT size=6 color=red>e</font> <FONT size=6>B</FONT>ook</i>,
<br>...in lovely HTML...
<br>for BeOS Release 5.
<center>
<br>
<p><font face=helvetiva>Copyright &copy; 2000 Be, Inc.  All rights reserved..
</body>
</html>

